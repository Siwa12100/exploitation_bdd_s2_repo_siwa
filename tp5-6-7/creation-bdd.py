import pandas as pd
import psycopg2 as psy

data = pd.read_csv(r'vgsales.csv')
df = pd.DataFrame(data)
df = df.drop_duplicates()
df = df.fillna(0)
# print(df)

try :
    co = psy.connect(host = 'londres',
                    database = 'dbjemarcilla',
                    user = 'jemarcilla',
                    password = "achanger")

    curs = co.cursor()


# Cr√©ation de la table : 
# ----------------------
    curs.execute('''DROP TABLE IF EXISTS JeuxVideos;''')

    curs.execute('''CREATE TABLE JeuxVideos(
                    Name varchar(150),
                    Platform varchar(150),
                    Year numeric(4),
                    Genre varchar(150),
                    Publisher varchar(150),
                    NA_Sales numeric(4,2),
                    EU_Sales numeric(4,2),
                    JP_Sales numeric(4,2),
                    Other_Sales numeric(4,2),
                    Global_Sales numeric(4,2),
                    PRIMARY KEY( Name, Platform, Year)
            )''')


# Insertion des valeurs dans la table :
# -------------------------------------
    for row in df.itertuples() :
        curs.execute( '''INSERT INTO JeuxVideos VALUES ( %s, %s, %s, %s, %s,%s,%s,%s,%s,%s )''',
                    (row.Name, row.Platform, row.Year, row.Genre, row.Publisher, row.NA_Sales, row.EU_Sales,
                    row.JP_Sales, row.Other_Sales, row.Global_Sales ))



    res = curs.fetchall()
    print(res)
    
    co.commit()
    curs.close()

except( Exception, psy.DatabaseError ) as error :
    print( error )

finally :
    if co is not None :
        co.close()





