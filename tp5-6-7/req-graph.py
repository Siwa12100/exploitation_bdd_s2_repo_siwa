import pandas as pd
import psycopg2 as psy

co = None


try :
    co = psy.connect(host = 'londres',
                    database = 'dbjemarcilla',
                    user = 'jemarcilla',
                    password = "achanger")


    #data = pd.read_sql('''SELECT * FROM JeuxVideos;''', con = co)

    curs = co.cursor()


# Recherche des valeurs Global Sales incohérentes :
# -------------------------------------------------
    # curs.execute( '''SELECT
    #                     jv.Name,
    #                     jv.Platform,
    #                     jv.Year,
    #                     jv.Publisher,
    #                     jv.Global_Sales
    #             FROM
    #                     JeuxVideos jv
    #             WHERE 
    #                 ( jv.NA_Sales + jv.EU_Sales + JP_Sales + Other_Sales ) != jv.Global_Sales;
    #               ''')


# Mise à jour des valeurs de ventes globales incohérentes :
# ---------------------------------------------------------
    # curs.execute('''UPDATE
    #                         JeuxVideos jv
    #                 SET
    #                         Global_Sales = ( jv.NA_Sales + jv.EU_Sales + JP_Sales + Other_Sales )
    #                 WHERE
    #                         ( jv.NA_Sales + jv.EU_Sales + JP_Sales + Other_Sales ) != jv.Global_Sales;
    #             ''')



# Mise a jour et creation du Dataframe :
# --------------------------------------
    data = pd.read_sql('''SELECT * FROM JeuxVideos;''', con = co)
    df = pd.DataFrame(data)



# Calcul des ventes moyennes par année de sortie des jeux ( pour les jeux du genre "Adventure") :
# -----------------------------------------------------------------------------------------------
# ( les jeux où n'est pas précisée l'année de sortie sont exclus )
    # curs.execute('''
    #                     SELECT
    #                             avg(jv.Global_Sales) AS Moyenne_ventes,
    #                             jv.Year AS Annee
    #                     FROM
    #                             JeuxVideos jv
    #                     WHERE
    #                             jv.Genre LIKE 'Adventure'
    #                             AND jv.Year != 'NaN'::numeric
    #                     GROUP BY
    #                             jv.Year
    #                     ORDER BY
    #                             jv.Year;
    #             ''')



# Afficher le résultat de la requête précédente sous forme de courbe :
# --------------------------------------------------------------------



# Affichage et fermeture du curseur et de la lecture :
# ----------------------------------------------------
    co.commit()
    res = curs.fetchall()
    #print(res)
    
    
    curs.close()

except( Exception, psy.DatabaseError ) as error :
    print( error )

finally :
    if co is not None :
        co.close()


