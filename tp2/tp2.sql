/*
    TP 2 SQL
    --------
*/


/*
    Question 1 :
    ------------
*/
-- Nombre d'athletes par pays.

--  SELECT p.nom AS nom_pays, count( * ) nb_athletes
--  FROM Pays p, Athlete a
--  Where p.code = a.pays
--  GROUP BY p.nom;


/*
    Question 2 :
    ------------
*/
-- Nombre d'épreuves par disciplines. 

 -- SELECT d.nom AS nom_niscipline, count( DISTINCT e.nom ) AS nb_epreuves
 -- FROM Discipline d, Epreuve e
 -- WHERE d.code = e.discipl
 -- GROUP BY d.nom;


/* 
    Question 3 :
    ------------
*/
-- Date de la dernière épreuve de chaque discipline

-- SELECT d.nom, MAX(e.dateE) derniere_epreuve
-- FROM Epreuve e, Discipline d 
-- WHERE d.code = e.discipl
-- GROUP BY d.nom;


/*
    Question 4 :
    ------------
*/
-- Date de naissance du plus jeune athlete par discipline et par sexe. 

-- Requête fausse à reprendre.....

-- SELECT
-- 		a.nom AS nom_athlete,
-- 		a.prenom AS prenom_athlete,
-- 		d.nom AS nom_discipline,
-- 		MAX( a.dateNaiss ) AS date_naissance,
-- 		a.sexe AS sexe_athlete
-- FROM
-- 		Athlete a,
-- 		Discipline d,
-- 		Resultat r,
-- 		Epreuve e 
-- WHERE
-- 		r.athlete = a.code
-- 		AND r.epreuve = e.code
-- 		AND e.discipl = d.code
-- 		AND d.nom LIKE 'Judo'
-- GROUP BY
-- 		d.nom,
-- 		a.sexe,
-- 		a.nom,
-- 		a.prenom;




/*
	Question 5 :
	------------
*/
--Nombre total de médailles par pays, les pays ayant remporté le plus de médailles en premier. 


--SELECT
--	p.nom AS nom_pays,
--	count(m.place) AS nb_medailles

--FROM 
--	Medaille m,
--	Pays p,
--	Athlete a,
--	Resultat r

--WHERE
--	r.medaille = m.place
--	AND r.athlete = a.code
--	AND a.pays = p.code

--GROUP BY
--	p.nom

--ORDER BY
--	nb_medailles DESC;
	


/*
	Question 6 :
	------------
*/
-- Nombre de médailles d'or par pays, les pays ayant remporté le plus de médailles en premier. 

--SELECT
--	p.nom AS nom_pays,
--	count(m.place) AS nb_medailles,
--	m.couleur AS verif_couleur_medaille
--FROM
--	Pays p,
--	Athlete a,
--	Medaille m,
--	Resultat r
--WHERE 
--	p.code = a.pays
--	AND a.code = r.athlete
--	AND r.medaille = m.place
--	AND m.place = 1
--GROUP BY 
--	p.nom,
--	m.couleur
--ORDER BY
--	nb_medailles DESC;



/*
	Question 7 :
	-------------
*/
-- Même question avec uniquement les pays ayant remporté plus de 30 médailles d'or.


--SELECT 
--	p.nom AS nom_pays,
--	count(m.place) AS nb_medailles_or,
--	m.couleur AS verif_couleur_medaille
--FROM 
--	Athlete a,
--      Pays p,
--	Resultat r,
--	Medaille m
--WHERE
--	p.code = a.pays
--	AND a.code = r.athlete
--	AND r.medaille = m.place
--	AND m.place = 1
--GROUP BY
--	nom_pays,
--	verif_couleur_medaille
--HAVING
--	count(m.place) >= 30
--ORDER BY
--	nb_medailles_or DESC;




/*
	Question 8 :
	------------
*/
-- Athletes pratiquant plusieurs disciplines. 

--SELECT
--	a.code,
--	a.nom,
--	a.prenom,
--	p.code,
--	count(d.code) AS nb_disciplines_pratiquees
--FROM
--	Pays p,
--	Athlete a,
--	Resultat r,
--	Epreuve e,
--	Discipline d
--WHERE
--	p.code = a.pays
--	AND a.code = r.athlete
--	AND r.epreuve = e.code
--	AND e.discipl = d.code

--GROUP BY
--	a.nom,
--	a.code,
--	a.prenom,
--	p.code
--HAVING
--	count(d.code) > 1
--ORDER BY
--	nb_disciplines_pratiquees DESC;



/*
	Question 9 :
	------------
*/
-- Pareil mais ayant remporté seulement et uniquement 4 médailles. 

--SELECT
--	a.code,
--	a.nom,
--	a.prenom,
--	p.nom,
--	count(m.couleur) AS nb_medailles
--FROM
--	Athlete a,
--	Pays p,
--	Resultat r,
--	Medaille m
--WHERE
--	m.place = r.medaille
--	AND r.athlete = a.code
--	AND a.pays = p.code
--GROUP BY
--	a.code,
--	a.nom,
--	a.prenom,
--	p.nom
--HAVING 
--	count(m.couleur) = 4
--ORDER BY 
--	a.nom,
--	a.prenom;




/*
	Question 10 :
	-------------
*/
-- Nombres d'athletes mineurs au début des jeux ( le 23/07/2021 ) par discipline, uniquement pour les disciplines ayant au moins 3 athletes. 

--SELECT
--	d.nom AS nom_discipline,
--	count(a.code) AS nb_athletes_mineurs

--FROM 
--	Athlete a,
--	Discipline d,
--	Pratiquer p
--WHERE 
--	a.code = p.athlete
--	AND p.discipl = d.code
--	AND extract( year from age( '2021-07-23', a.dateNaiss)) < 18
--GROUP BY
--	d.nom,
--	a.code
--HAVING
--	count(a.code) <= 3
--ORDER BY
--	nb_athletes_mineurs DESC;



/*
	Question 11 :
	-------------
*/
-- Pays ayant le plus d'athletes. 

-- SELECT p.nom, COUNT(a.code) as nombre_athletes
-- FROM Pays 
-- JOIN Athlete a ON a.pays = p.code
-- GROUP BY p.nom
-- ORDER BY COUNT(a.code) DESC
-- LIMIT 3;

-- En gros on renvoie le nombre d'athletes par pays, on le classe  du plus grand au plus petit et on renvoie que la première valeur grâce au limit. 


	



