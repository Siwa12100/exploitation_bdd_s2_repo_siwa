
/* Question 1 :
--------------- */
--  SELECT
-- 	D.nom
-- FROM 
-- 	Discipline D
-- INNER JOIN 
-- 	Epreuve E ON D.code = E.discipl
-- WHERE 
-- 	EXTRACT(MONTH FROM E.dateE) = 7 
-- 	OR EXTRACT(MONTH FROM E.dateE) = 8
-- GROUP BY 
-- 	D.code, D.nom
-- HAVING
-- 	COUNT(CASE WHEN EXTRACT(MONTH FROM E.dateE) = 7 THEN 1 ELSE NULL END) > COUNT(CASE WHEN EXTRACT(MONTH FROM E.dateE) = 8 THEN 1 ELSE NULL END);




/* Question 2 :
--------------- */

-- SELECT 
--	paysNaiss,
--        count(DISTINCT Athlete.code) as nb_athletes,
--        count(DISTINCT Resultat.athlete) as nb_medailles
-- FROM 
--	Athlete
-- LEFT JOIN
--	Resultat ON Athlete.code = Resultat.athlete
--GROUP BY 
--	paysNaiss
-- HAVING 
--	count(DISTINCT Resultat.athlete) >= 0.5 * count(DISTINCT Athlete.code);



/* Question 3 :
--------------*/

--SELECT
--	p.nom
--FROM 
--	Pays p
--JOIN
--	Athlete a ON p.code = a.pays
--JOIN
--	Resultat r ON a.code = r.athlete
--JOIN 
--	Medaille m ON r.medaille = m.place
--GROUP BY
--	p.nom
--HAVING 
--	COUNT(CASE WHEN m.couleur = 'Or' THEN 1 END) > COUNT(CASE WHEN m.couleur IN ('Argent', 'Bronze') THEN 1 END);



/* Question 4 :
---------------*/


--SELECT 
--	a.nom, a.prenom
--FROM
--	Athlete a
--WHERE
--	a.sexe = 'F'
--	AND a.taille > ALL (
   -- 				SELECT 
--					MAX(a2.taille)
    --				FROM
--			       		Athlete a2
   -- 				WHERE 
--					a2.sexe = 'M'
   -- 					AND a2.pays = a.pays
--);




/* Question 5 :
--------------- */

--SELECT 
--	a.nom, a.prenom, a.taille, (
--					SELECT
--				       		MAX(a2.taille) 
--					FROM 
--						Athlete a2
--					WHERE 
--						a2.sexe = 'M' AND a2.pays = 'FRA') as max
--FROM 
--	Athlete a
--WHERE 
--	a.sexe = 'M'
--	AND a.pays = 'FRA';





/* Question 6 :
--------------- */

-- SELECT 
-- 	e.code, e.discipl, e.nom, e.dateE,
-- 	(SELECT MIN(e2.dateE) FROM Epreuve e2 WHERE e2.discipl = e.discipl) as datemin,
-- 	(SELECT MAX(e3.dateE) FROM Epreuve e3 WHERE e3.discipl = e.discipl) as datemax
-- FROM
-- 	Epreuve e
-- JOIN
-- 	Resultat r ON e.code = r.epreuve
-- GROUP BY
-- 	e.code, e.discipl, e.nom, e.datee;



/* Question 7 :
--------------- */

-- UPDATE
-- 		Epreuve 
-- SET
--     dateE = dateE + 7    
-- WHERE
-- 	dateE = ( SELECT
-- 		                        MAX( e1.dateE ) AS date_epreuve
-- 						FROM
-- 						        Epreuve e1
-- 						);


-- -- Requête simplement pour verifier que l'update a bien marché 
-- SELECT
--         e.code AS code_epreuve,
-- 		e.nom AS nom_epreuve,
-- 		d.nom AS nom_discipline,
-- 		e.dateE AS date_epreuve
-- FROM
--         Epreuve e,
-- 		Discipline d 
-- WHERE
--         d.code = e.discipl
-- 		AND e.dateE IN ( SELECT
-- 		                        MAX( e1.dateE ) AS date_epreuve
-- 						FROM 
-- 						        Epreuve e1
-- 						);





/* Question 8 :
--------------- */

SELECT
       p.nom AS nom_pays,
	   d.nom AS nom_discipline,
	   count( m.couleur ) AS nb_medailles
FROM
      Athlete a,
	  Pays p,
	  Resultat r,
	  Medaille m,
	  Discipline d,
	  Epreuve e 
WHERE
      a.pays = p.code
	  AND r.athlete = a.code
	  AND r.epreuve = e.code
	  AND m.place = r.medaille
	  AND e.discipl = d.code
	  AND d.nom LIKE 'Weightlifting'

GROUP BY
      p.nom,
	  d.nom
ORDER BY
      count( m.couleur ) DESC;


